---
title: "Subscription Aggregator for 3x-ui Proxy Servers"
date: 2025-03-22 00:00:01
type: posts
tags:
  - vpn
weight: 2
draft: false
---

**Subscription Aggregator for 3x-ui Proxy Servers** ‚Äî —ç—Ç–æ –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ 3x-ui, –≤ –æ–¥–Ω—É —Å—Å—ã–ª–∫—É. –ü—Ä–æ–µ–∫—Ç —Ä–∞—Å—à–∏—Ä—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–æ–∫ 3x-ui –∏ –¥–µ–ª–∞–µ—Ç –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–µ —É–¥–æ–±–Ω—ã–º.

<!--more-->

## –î–ª—è —á–µ–≥–æ
–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ 3x-ui –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤, –∫–∞–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, Marzban. –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –µ–¥–∏–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–¥–ø–∏—Å–∫–∞–º —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–≤, –æ–±–ª–µ–≥—á–∞—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å —Å subscription_id –∏ –¥—É–±–ª–∏—Ä—É–µ—Ç –µ–≥–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞ 3x-ui. –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –≤–∏–¥–µ base64 —Å—Ç—Ä–æ–∫–∏. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏—Ö –∏ —Å–Ω–æ–≤–∞ –∫–æ–¥–∏—Ä—É–µ—Ç –≤ base64. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –ª–∏—à—å –æ–¥–∏–Ω URL, —Å—Å—ã–ª–∞—é—â–∏–π—Å—è –Ω–∞ Nginx —Å–µ—Ä–≤–µ—Ä, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º.

–¢–∞–∫, –µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ `https://example.com/sub/test`, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫, –∫ –ø—Ä–∏–º–µ—Ä—É –Ω–∞ `https://3x-ui_server/subscription/test` –∏ `https://another_server/podpiska/test`. –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞–π–¥–µ–Ω—ã, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏—Ö, –≤–æ–∑–≤—Ä–∞—â–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é base64 —Å—Ç—Ä–æ–∫—É.

## –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
üêçüöÄ Backend: Python + FastAPI + httpx  

üåêüîí –°–µ—Ä–≤–µ—Ä: Nginx  

üê≥üõ†Ô∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: Docker

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏—á–∏
‚úÖ **–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫** ‚Äî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –∏—Ö –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ –æ–¥–Ω—É —Å—Å—ã–ª–∫—É

‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞** ‚Äî –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ Python (FastAPI), –∞ —Ç–∞–∫–∂–µ Nginx

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HTTPS –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç —Å HTTP

‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è** ‚Äî –ë–ª–∞–≥–æ–¥–∞—Ä—è Docker

---
## –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
–í—Å–µ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ [GitHub](https://github.com/NoisyCake/3x-ui_subscriptions_aggregator#). –î–∞–ª–µ–µ —Ä–∞–∑–±–µ—Ä—ë–º –ª–æ–≥–∏–∫—É –ø—Ä–æ–µ–∫—Ç–∞, –∞ –∏–º–µ–Ω–Ω–æ `main.py` —Ñ–∞–π–ª.

### –ò–º–ø–æ—Ä—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫  
- `os` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è; 
- `httpx` –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤;
- `base64` –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞;
- `logging` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫;
- `asyncio.gather` –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á;
- `typing.Optional` –¥–ª—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏, –ø–æ—Å–∫–æ–ª—å–∫—É –≤ –∫–∞—á–µ—Å—Ç–≤–µ Docker-–æ–±—Ä–∞–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä–∞—è –ª–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è –≤–µ—Ä—Å–∏—è Python, –≤ –∫–æ—Ç–æ—Ä–æ–π –µ—â—ë –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–∏ —Ñ–∏—á–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏;
- `dotenv.load_dotenv` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è;
- `fastapi` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.

```py
import os
import httpx
import base64
import logging
from asyncio import gather
from typing import Optional
from dotenv import load_dotenv
from fastapi import FastAPI, Response, HTTPException
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–µ—Ä–∞  
–ó–¥–µ—Å—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è. –í —Ñ–∞–π–ª script_log.log –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ {–¥–∞—Ç–∞_–∏_–≤—Ä–µ–º—è —É—Ä–æ–≤–µ–Ω—å_–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–µ}
```py
logging.basicConfig(
    level=logging.WARNING, filename='script_log.log',
    format='%(asctime)s %(levelname)s: %(message)s'
)
logger = logging.getLogger(__name__)
```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FastAPI  
–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ–∑–¥–∞—ë—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ –≤—Ç–æ—Ä–∞—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞ `.env`.
```py
app = FastAPI()
load_dotenv()
path = os.getenv('URL')
```

### –§—É–Ω–∫—Ü–∏—è `fetch_subscription`
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π GET-–∑–∞–ø—Ä–æ—Å –∫ sub_url/sub_id. –í —Å–ª—É—á–∞–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç base64 –≤ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –∏–Ω–∞—á–µ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None` –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∏.
```py
async def fetch_subscription(client, sub_url: str, sub_id: str) -> Optional[bytes]:
    try:
        sub = await client.get(f'{sub_url}{sub_id}', timeout=5)
        sub.raise_for_status()
        return base64.b64decode(sub.text)
    except httpx.HTTPError as e:
            logger.error(f"Can't get subscription url from {sub_url}{sub_id}: {str(e)}")
    except ValueError as e:
            logger.error(f"Can't decode base64 for {sub_url}{sub_id}: {str(e)}")
```

### –§—É–Ω–∫—Ü–∏—è `merge_subscriptions`
1. –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ URL –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è;
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞;
1. –°–æ–∑–¥–∞—ë—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç;
1. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ —Å–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤;
1. –§–∏–ª—å—Ç—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –Ω–µ—É–¥–∞—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã;
1. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏ –∫–æ–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ;
1. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –≤ –≤–∏–¥–µ –≥–æ–ª–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
```py
@app.get(f'/{path}/{{sub_id}}')
async def merge_subscriptions(sub_id: str) -> Response:
    sub_urls = os.getenv('SUB_URLS').split()
    
    if not sub_urls:
        logger.error("Servers not found")
        raise HTTPException(status_code=500, detail="Servers not found")
    
    
    async with httpx.AsyncClient() as client:
        decoded_subs = [fetch_subscription(client, sub_url, sub_id) for sub_url in sub_urls]
        results = await gather(*decoded_subs)
        data = [result for result in results if result is not None]
        
        if not data:
            logger.error("No subscriptions available")
            raise HTTPException(status_code=500, detail="No subscriptions available")    
        
        merged_subs = b''.join(data)
        global_sub = base64.b64encode(merged_subs)
        
        return Response(content=global_sub, media_type='text/plain')
```

---
## –£—Å—Ç–∞–Ω–æ–≤–∫–∞
–ü—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞–Ω –≤ [README.md](https://github.com/NoisyCake/3x-ui_subscriptions_aggregator#) –ø—Ä–æ–µ–∫—Ç–∞.

## –°—Å—ã–ª–∫–∏
**GitHub-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–æ–µ–∫—Ç–∞**: https://github.com/NoisyCake/3x-ui_subscriptions_aggregator#  
**–ê–≤—Ç–æ—Ä**: https://t.me/noisycake  
**–¢–ö–ì**: https://t.me/hfk_blog  
**Teletype**: https://teletype.in/@noisycake

## –õ–∏—Ü–µ–Ω–∑–∏—è
–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ —Ñ–∞–π–ª–µ [LICENSE](https://github.com/NoisyCake/3x-ui_subscriptions_aggregator/blob/main/LICENSE).