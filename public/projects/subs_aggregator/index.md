# Subscription Aggregator for 3x-ui Proxy Servers


**Subscription Aggregator for 3x-ui Proxy Servers** â€” ÑÑ‚Ð¾ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐºÑÐ¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÑÐµÑ‚ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸ Ñ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ð¿Ñ€Ð¾ÐºÑÐ¸-ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð², Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‰Ð¸Ñ… Ð½Ð° Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ðµ 3x-ui, Ð² Ð¾Ð´Ð½Ñƒ ÑÑÑ‹Ð»ÐºÑƒ. ÐŸÑ€Ð¾ÐµÐºÑ‚ Ñ€Ð°ÑÑˆÐ¸Ñ€ÑÐµÑ‚ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº 3x-ui Ð¸ Ð´ÐµÐ»Ð°ÐµÑ‚ Ð¸Ñ… Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð±Ð¾Ð»ÐµÐµ ÑƒÐ´Ð¾Ð±Ð½Ñ‹Ð¼.

&lt;!--more--&gt;

## Ð”Ð»Ñ Ñ‡ÐµÐ³Ð¾
ÐŸÐ»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ð° 3x-ui Ð½Ðµ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð², ÐºÐ°Ðº, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Marzban. Ð­Ñ‚Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ñ‡Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾ Ñ€ÐµÑˆÐ°ÐµÑ‚ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ, Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÑ ÐµÐ´Ð¸Ð½ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ Ð´Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ°Ð¼ Ñ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ð¿Ñ€Ð¾ÐºÑÐ¸-ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð², Ð¾Ð±Ð»ÐµÐ³Ñ‡Ð°Ñ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹.

## ÐšÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ñ subscription_id Ð¸ Ð´ÑƒÐ±Ð»Ð¸Ñ€ÑƒÐµÑ‚ ÐµÐ³Ð¾ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ð° 3x-ui. ÐšÐ°Ð¶Ð´Ñ‹Ð¹ ÑÐµÑ€Ð²ÐµÑ€ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ Ð² Ð²Ð¸Ð´Ðµ base64 ÑÑ‚Ñ€Ð¾ÐºÐ¸. ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð´ÐµÐºÐ¾Ð´Ð¸Ñ€ÑƒÐµÑ‚ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ, Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÑÐµÑ‚ Ð¸Ñ… Ð¸ ÑÐ½Ð¾Ð²Ð° ÐºÐ¾Ð´Ð¸Ñ€ÑƒÐµÑ‚ Ð² base64. ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ Ð½ÑƒÐ¶Ð½Ð¾ Ð²ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð»Ð¸ÑˆÑŒ Ð¾Ð´Ð¸Ð½ URL, ÑÑÑ‹Ð»Ð°ÑŽÑ‰Ð¸Ð¹ÑÑ Ð½Ð° Nginx ÑÐµÑ€Ð²ÐµÑ€, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ ÐºÐ¾ Ð²ÑÐµÐ¼ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑÐ¼.

Ð¢Ð°Ðº, ÐµÑÐ»Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð½Ð° `https://example.com/sub/test`, Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð½Ð° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº, Ðº Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñƒ Ð½Ð° `https://3x-ui_server/subscription/test` Ð¸ `https://another_server/podpiska/test`. Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹, Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ Ð¸ Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÑÐµÑ‚ Ð¸Ñ…, Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ base64 ÑÑ‚Ñ€Ð¾ÐºÑƒ.

## Ð¡Ñ‚ÐµÐº Ñ‚ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¹
ðŸðŸš€ Backend: Python &#43; FastAPI &#43; httpx  

ðŸŒðŸ”’ Ð¡ÐµÑ€Ð²ÐµÑ€: Nginx  

ðŸ³ðŸ› ï¸ Ð˜Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°: Docker

## ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ñ„Ð¸Ñ‡Ð¸
âœ… **ÐžÐ±ÑŠÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº** â€” ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¸Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ð¿Ñ€Ð¾ÐºÑÐ¸-ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð² Ð¸ Ð¸Ñ… Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð² Ð¾Ð´Ð½Ñƒ ÑÑÑ‹Ð»ÐºÑƒ

âœ… **ÐÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð°Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°** â€” Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾Ð³Ð¾ Python (FastAPI), Ð° Ñ‚Ð°ÐºÐ¶Ðµ Nginx

âœ… **Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ** â€” ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ HTTPS Ð¸ Ñ€ÐµÐ´Ð¸Ñ€ÐµÐºÑ‚ Ñ HTTP

âœ… **ÐŸÑ€Ð¾ÑÑ‚Ð¾Ñ‚Ð° Ñ€Ð°Ð·Ð²Ñ‘Ñ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ** â€” Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ñ Docker

---
## Ð˜ÑÑ…Ð¾Ð´Ð½Ñ‹Ð¹ ÐºÐ¾Ð´
Ð’ÑÐµ Ð¸ÑÑ…Ð¾Ð´Ð½Ð¸ÐºÐ¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð½Ð° [GitHub](https://github.com/NoisyCake/3x-ui_subscriptions_aggregator#). Ð”Ð°Ð»ÐµÐµ Ñ€Ð°Ð·Ð±ÐµÑ€Ñ‘Ð¼ Ð»Ð¾Ð³Ð¸ÐºÑƒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°, Ð° Ð¸Ð¼ÐµÐ½Ð½Ð¾ `main.py` Ñ„Ð°Ð¹Ð».

### Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐº  
- `os` Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¼Ð¸ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ; 
- `httpx` Ð´Ð»Ñ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ñ… HTTP-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²;
- `base64` Ð´Ð»Ñ ÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¸ Ð´ÐµÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð°;
- `logging` Ð´Ð»Ñ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¾ÑˆÐ¸Ð±Ð¾Ðº;
- `asyncio.gather` Ð´Ð»Ñ Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾Ð³Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ñ… Ð·Ð°Ð´Ð°Ñ‡;
- `typing.Optional` Ð´Ð»Ñ Ð°Ð½Ð½Ð¾Ñ‚Ð°Ñ†Ð¸Ð¸, Ð¿Ð¾ÑÐºÐ¾Ð»ÑŒÐºÑƒ Ð² ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Docker-Ð¾Ð±Ñ€Ð°Ð·Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ ÑÑ‚Ð°Ñ€Ð°Ñ Ð»ÐµÐ³ÐºÐ¾Ð²ÐµÑÐ½Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ Python, Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¹ ÐµÑ‰Ñ‘ Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÑŽÑ‚ÑÑ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¸ Ñ„Ð¸Ñ‡Ð¸ Ð°Ð½Ð½Ð¾Ñ‚Ð°Ñ†Ð¸Ð¸;
- `dotenv.load_dotenv` Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ;
- `fastapi` Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð².

```py
import os
import httpx
import base64
import logging
from asyncio import gather
from typing import Optional
from dotenv import load_dotenv
from fastapi import FastAPI, Response, HTTPException
```

### ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð»Ð¾Ð³ÐµÑ€Ð°  
Ð—Ð´ÐµÑÑŒ Ð½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÑ‚ÑÑ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ. Ð’ Ñ„Ð°Ð¹Ð» script_log.log Ð·Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÑŽÑ‚ÑÑ Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ {Ð´Ð°Ñ‚Ð°_Ð¸_Ð²Ñ€ÐµÐ¼Ñ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ_Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ}
```py
logging.basicConfig(
    level=logging.WARNING, filename=&#39;script_log.log&#39;,
    format=&#39;%(asctime)s %(levelname)s: %(message)s&#39;
)
logger = logging.getLogger(__name__)
```

### Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ FastAPI  
ÐŸÐµÑ€Ð²Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€ Ð²ÐµÐ±-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ, Ð° Ð²Ñ‚Ð¾Ñ€Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð¸Ð· Ñ„Ð°Ð¹Ð»Ð° `.env`.
```py
app = FastAPI()
load_dotenv()
```

### Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ `fetch_subscription`
ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ð¹ GET-Ð·Ð°Ð¿Ñ€Ð¾Ñ Ðº sub_url/sub_id. Ð’ ÑÐ»ÑƒÑ‡Ð°Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð³Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð° Ð´ÐµÐºÐ¾Ð´Ð¸Ñ€ÑƒÐµÑ‚ base64 Ð² Ð±Ð¸Ð½Ð°Ñ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚, Ð¸Ð½Ð°Ñ‡Ðµ â€” Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ `None` Ð¸ Ð·Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÑƒ Ð² Ð»Ð¾Ð³Ð¸.
```py
async def fetch_subscription(client, sub_url: str, sub_id: str) -&gt; Optional[bytes]:
    try:
        sub = await client.get(f&#39;{sub_url}{sub_id}&#39;, timeout=5)
        sub.raise_for_status()
        return base64.b64decode(sub.text)
    except httpx.HTTPError as e:
            logger.error(f&#34;Can&#39;t get subscription url from {sub_url}{sub_id}: {str(e)}&#34;)
    except ValueError as e:
            logger.error(f&#34;Can&#39;t decode base64 for {sub_url}{sub_id}: {str(e)}&#34;)
```

### Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ `merge_subscriptions`
1. ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ ÑÐ¿Ð¸ÑÐ¾Ðº URL Ð¸Ð· Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ;
1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ñ…Ð¾Ñ‚Ñ Ð±Ñ‹ Ð¾Ð´Ð½Ð¾Ð³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°;
1. Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ñ‚ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ð¹ ÐºÐ»Ð¸ÐµÐ½Ñ‚;
1. ÐŸÐ°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾ Ð·Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸ ÑÐ¾ Ð²ÑÐµÑ… ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð²;
1. Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ÑƒÐµÑ‚ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ±Ñ€Ð°Ñ‚ÑŒ Ð½ÐµÑƒÐ´Ð°Ñ‡Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹;
1. ÐžÐ±ÑŠÐµÐ´Ð¸Ð½ÑÐµÑ‚ Ð¸ ÐºÐ¾Ð´Ð¸Ñ€ÑƒÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ;
1. Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚ Ð² Ð²Ð¸Ð´Ðµ Ð³Ð¾Ð»Ð¾Ð³Ð¾ Ñ‚ÐµÐºÑÑ‚Ð°.
```py
@app.get(&#39;/sub/{sub_id}&#39;)
async def merge_subscriptions(sub_id: str) -&gt; Response:
    sub_urls = os.getenv(&#39;SUB_URLS&#39;).split()
    
    if not sub_urls:
        logger.error(&#34;Servers not found&#34;)
        raise HTTPException(status_code=500, detail=&#34;Servers not found&#34;)
    
    
    async with httpx.AsyncClient() as client:
        decoded_subs = [fetch_subscription(client, sub_url, sub_id) for sub_url in sub_urls]
        results = await gather(*decoded_subs)
        data = [result for result in results if result is not None]
        
        if not data:
            logger.error(&#34;No subscriptions available&#34;)
            raise HTTPException(status_code=500, detail=&#34;No subscriptions available&#34;)    
        
        merged_subs = b&#39;&#39;.join(data)
        global_sub = base64.b64encode(merged_subs)
        
        return Response(content=global_sub, media_type=&#39;text/plain&#39;)
```

---
## Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°
ÐŸÑ€Ð¾Ñ†ÐµÑÑ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾ Ð¾Ð¿Ð¸ÑÐ°Ð½ Ð² [README.md](https://github.com/NoisyCake/3x-ui_subscriptions_aggregator#) Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°.

## Ð¡ÑÑ‹Ð»ÐºÐ¸
**GitHub-Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°**: https://github.com/NoisyCake/3x-ui_subscriptions_aggregator#  
**ÐÐ²Ñ‚Ð¾Ñ€**: https://t.me/noisycake  
**Ð¢ÐšÐ“**: https://t.me/hfk_blog  
**Teletype**: https://teletype.in/@noisycake

## Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ
ÐŸÑ€Ð¾ÐµÐºÑ‚ Ñ€Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ Ð¿Ð¾Ð´ Ð»Ð¸Ñ†ÐµÐ½Ð·Ð¸ÐµÐ¹ MIT. ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½Ð¾ÑÑ‚Ð¸ Ð² Ñ„Ð°Ð¹Ð»Ðµ [LICENSE](https://github.com/NoisyCake/3x-ui_subscriptions_aggregator/blob/main/LICENSE).

---

> ÐÐ²Ñ‚Ð¾Ñ€: [NoisyCake](https://t.me/noisycake)  
> URL: http://localhost:1313/projects/subs_aggregator/  

